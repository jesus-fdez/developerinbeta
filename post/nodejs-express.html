<meta property="og:image" content="assets/img/node01.jpg">
<meta property="og:image:type" content="image/jpg">
<meta property="og:image:width" content="700">
<meta property="og:image:height" content="350">

<div class="container">
    <div class="row">
        <div class="col-11 mx-auto">
            
            <article>
                <header class="mb-4">
                    <h1 class="fw-bolder mb-1">C√≥mo crear un API Rest con Node.js y Express.</h1>
                    <a class="badge bg-secondary text-decoration-none link-light mt-3" href="#!">Nodejs</a>
                    <div class="mt-3"><img src="assets/img/profile-s.jpg" class="profile" alt="Jes√∫s Fdez." /> Jes√∫s Fdez.</div>
                </header>
                
                <figure class="text-center" style="background-color: #E0DCE2;">
                    <img class="img-fluid" src="assets/img/node01.jpg" alt="Nodejs y Express" />
                </figure>

                <p><span class="blue">Node.js</span> es una de las tecnolog√≠as m√°s populares para construir APIs r√°pidas, escalables y modernas. En este art√≠culo te mostrar√© c√≥mo instalar Node.js, c√≥mo iniciar un proyecto con Express y c√≥mo estructurarlo siguiendo la filosof√≠a de Clean Architecture propuesta por Uncle Bob.</p>

                <h5>1. Instalaci√≥n de Node.js</h5>

                <p>Antes de empezar, necesitas tener Node.js y npm (Node Package Manager) instalados. Puedes descargarlo desde su sitio oficial <a href="https://nodejs.org" target="_blank">https://nodejs.org</a></p>

                <p></p>

                <p>Para comprobar si ya tienes Node.js y npm instalados, ejecuta en tu terminal:</p>

<pre><code class="language-bash">node -v
npm -v</code></pre>

                <p>Deber√≠as ver las versiones de ambas.</p>

                <h5>2. Inicializar el proyecto y a√±adir Express</h5>

                <p>Una vez instalado Node.js, crea una carpeta para tu proyecto y ejecuta lo siguiente:</p>

<pre><code class="language-bash">mkdir my-api
cd my-api
npm init -y</code></pre>

                <p>Ahora instala Express, que es el framework que nos proporciona un conjunto de herramientas para:</p>
                <ul>
                    <li>Crear aplicaciones web.</li>
                    <li>Peticiones y respuestas HTTP.</li>
                    <li>Enrutamiento y middleware para construir y desplegar aplicaciones a gran escala.</li>
                </ul>

                <pre><code class="language-bash">npm install express</code></pre>

                <p>Este comando crear√° un archivo <code>package.json</code> en el directorio de tu proyecto. Este archivo contiene informaci√≥n sobre tu proyecto, como el nombre, la versi√≥n, las dependencias, etc. Se ver√° algo as√≠:</p>

<pre><code class="language-javascript">{
    "name": "my-api",
    "version": "1.0.0",
    "main": "index.js",
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1"
    },
    "keywords": [],
    "author": "",
    "license": "ISC",
    "description": "",
    "dependencies": {
      "express": "^5.1.0"
    }
}</code></pre>

                <h5>3. Instalar Nodemon</h5>
                <p>Antes de seguir, vamos a instalar una utilidad para que NO tengas que parar e iniciar de nuevo la aplicaci√≥n cada vez que realices cambios en el c√≥digo. Esto lo har√° <a href="https://www.npmjs.com/package/nodemon" target="_blank">Nodemon</a> por ti.</p>
                <p>Vamos a instalarlo de forma global, para que ya lo tengas disponible para dem√°s proyectos Node:</p>
                <pre><code class="language-bash">npm install -g nodemon</code></pre>
                <p>En cualquier proyecto node que tengas, crea una nueva entrada script en el <code>package.json</code> arrancando nuestra instancia de Node con nodemon:</p>
<pre><code class="language-javascript">"scripts": {
    "dev": "nodemon index.js"
}</code></pre>

                <h5>4. Crear index.js</h5>
                <p>Vamos a crear nuestro archivo principal <code>index.js</code>, en la carpeta ra√≠z de nuestro proyecto. Este archivo desempe√±ar√° el papel fundamental de punto de entrada para nuestra aplicaci√≥n. En √©l, importar√°s el m√≥dulo Express y generar√°s una instancia de la aplicaci√≥n. El contenido <code>index.js</code> ser√° el siguiente:</p>
<pre><code class="language-javascript">const express = require('express');
const app = express();
const router = express.Router();
const port = 3000

app.listen(port, () => {
    console.log(`Server listening on http://localhost:${port}`);
});

module.exports = router;</code></pre>

                <p>Una vez listo <code>index.js</code> y configurado Nodemon en <code>package.json</code>, lanzamos la aplicaci√≥n:</p>
                <pre><code class="language-bash">npm run dev</code></pre>

                <p>Ver√°s en consola algo similar a lo siguiente:</p>
<pre><code class="language-javascript">npm run dev

    > my-api@1.0.0 dev
    > nodemon index.js
    
    [nodemon] 3.1.9
    [nodemon] to restart at any time, enter `rs`
    [nodemon] watching path(s): *.*
    [nodemon] watching extensions: js,mjs,cjs,json
    [nodemon] starting `node index.js`
    Server listening on http://localhost:3000</code></pre>

                <p>Ah√≠ podemos ver nuestro mensaje <code>Server listening on http://localhost:3000</code>. De momento no hemos hecho nada para responder peticiones http. Antes de desarrollar routes, controllers y dem√°s, vamos a plantear una estructura de proyecto con capas separadas que sea escalable.</p>

                <h5>5. Estructura del proyecto con Clean Architecture</h5>

                <p>Clean Architecture sugiere separar las responsabilidades en capas bien definidas. A continuaci√≥n, una posible estructura para tu API:</p>

<pre><code class="language-bash">my-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usecases/
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ package.json
</code></pre>

                <p>Explicaci√≥n r√°pida:</p>
                <ul>
                <li><strong>domain/</strong>: Contiene l√≥gica de negocio pura, sin dependencias.</li>
                <li><strong>infrastructure/</strong>: Configuraciones, conexiones externas (DB, servicios).</li>
                <li><strong>interfaces/</strong>: Entradas y salidas, como controladores y rutas.</li>
                <li><strong>app/</strong>: Punto de entrada de la aplicaci√≥n.</li>
                </ul>

                <h5>6. Crear un endpoint b√°sico</h5>

                <p>Vamos a crear un endpoint de ejemplo. Primero, crea el archivo <code>src/app/server.js</code> con el contenido de index.js. Iremos creando ya la estructura propuesta en el punto 5, as√≠ que el punto de entrada de la app estar√° en <code>src/app</code> y lo tendremos en un fichero llamado <code>server.js</code>. Como hemos dicho tiene la misma misi√≥n que <code>index.js</code> (as√≠ que puedes borrarlo y nos quedamos s√≥lo con <code>server.js</code>):</p>

<pre><code class="language-javascript">// src/app/server.js
const port = 3000
const express = require('express');
const app = express();
const cors = require('cors');
const routes = require('../interfaces/routes');

app.use(cors())
app.use('/api', routes);

app.listen(port, () => {
    console.log(`Server listening on http://localhost:${port}`);
});
</code></pre>

                <p>Luego crea la ruta GET en su paquete:</p>

<pre><code class="language-javascript">// src/interfaces/routes/index.js
const express = require('express');
const router = express.Router();
const helloController = require('../controllers/HelloController');

router.get('/hello', helloController.sayHello);

module.exports = router;
</code></pre>

                <p>Y finalmente el controlador:</p>

<pre><code class="language-javascript">// src/interfaces/controllers/HelloController.js
exports.sayHello = (req, res) => {
    try {
        res.json({ message: 'Hola desde tu primera API con Clean Architecture!' });
    } catch(err) {
        console.log(err)
    }
};
</code></pre>

                <h5>5. Instalar cors</h5>
                <p>Te habr√° llamada la atenci√≥n esta l√≠nea <code>const cors = require('cors');</code>.</p>
                <p><b>¬øC√≥mo funciona CORS?</b></p>
                <p>Cuando un frontend realiza una solicitud de origen cruzado, el navegador primero env√≠a una solicitud de verificaci√≥n previa (una solicitud HTTP OPTIONS) al servidor. Esta solicitud comprueba si el servidor permite la solicitud original (por ejemplo, una POSTsolicitud con ciertos encabezados) del dominio de origen. Si el servidor responde con los encabezados CORS correctos, el navegador permite la solicitud; de lo contrario, la bloquea.</p>
                <p>¬øC√≥mo se configura cors en apps con Node.js? Sencillo, instal√°ndolo desde consola:</p>
                <pre><code class="language-bash">npm install cors</code></pre>
                <p>Luego import√°ndolo en el proyecyo con <code>require</code>, como has visto en el c√≥digo.</p>

                <h5>6. Ejecutar el API</h5>
                <p>Ahora ya s√≠ puedes lanzar el API, hay que indicarle a Nodemon que ahora debe ejecutar <code>src/app/server.js</code>. Modifica en <code>package.json</code>:</p>
                <pre><code class="language-javascript">"dev": "nodemon index.js"</code></pre>
                <p>por</p>
                <pre><code class="language-bash">"dev": "nodemon src/app/server.js"</code></pre>

                <p>Lanzamos en consola, si no lo tenemos ya, <code>npm run dev</code>, recuerda... Nodemon ya se encarga de refrescar el comando cuando haya cambios en el c√≥digo.</p>
                <p>Y prueba tu endpoint accediendo a <code>http://localhost:3000/api/hello</code>.</p>

                <img src="assets/img/node02.jpg" />

                <h5>üìù Resumen</h5>
                <p><code>server.js</code> es el punto de entrada de la aplicaci√≥n. Adem√°s de otras cosas que hemos visto, importa <code>../interfaces/routes</code> y luego hace uso de las rutas con <code>app.use('/api', routes);</code>. El paquete <code>routes</code> tiene un <code>index.js</code> donde define las rutas con su controller. Cada controller gestiona la recepci√≥n de las peticiones.</p>
                
                <h5>üí° Organizaci√≥n del c√≥digo</h5>
                <p>El controller no deber√≠a tener l√≥gica de negocio, s√≥lo deber√≠a invocar a los <code>usecases (domain)</code> y √©stos a los <code>repos (infrastructure)</code>. Ese podr√≠a ser un flujo b√°sico de una petici√≥n, as√≠ tenemos separadas las capas.</p>
                
                <h5>üèÜ Conclusi√≥n</h5>
                <p>Con esta estructura, tu API es escalable, modular y f√°cil de mantener. Clean Architecture te permite separar las preocupaciones, facilitando las pruebas, el mantenimiento y la incorporaci√≥n de nuevas funcionalidades. En pr√≥ximos art√≠culos profundizaremos en c√≥mo a√±adir use cases, repositorios y pruebas automatizadas.</p>
            </article>

        </div>
    </div>
</div>